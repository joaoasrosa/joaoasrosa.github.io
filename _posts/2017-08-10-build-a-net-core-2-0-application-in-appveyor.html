---
layout: single
title: Build a .NET Core 2.0 Application in AppVeyor
date: 2017-08-10 11:45:01.000000000 +02:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Continuous Integration
- OSS
tags:
- ".NET Core"
- AppVeyor
- Gist
- GitHub
- PowerShell
meta:
  _wpcom_is_markdown: '1'
  _publicize_done_external: a:1:{s:7:"twitter";a:1:{i:15487188;s:56:"https://twitter.com/joaoasrosa/status/895581765506662400";}}
  _rest_api_published: '1'
  _rest_api_client_id: "-1"
  _publicize_job_id: '8122770253'
  publicize_google_plus_url: https://plus.google.com/105879670784970671735/posts/g2HZDC5hkC4
  _publicize_done_15567246: '1'
  _wpas_done_15420870: '1'
  _publicize_done_15638091: '1'
  _wpas_done_15487188: '1'
  publicize_twitter_user: joaoasrosa
  _publicize_failed_15638097: O:13:"Keyring_Error":2:{s:6:"errors";a:1:{s:21:"keyring-request-error";a:1:{i:0;a:6:{s:7:"headers";O:42:"Requests_Utility_CaseInsensitiveDictionary":1:{s:7:"
author:
  login: joaoasrosa
  email: joaoasrosa@gmail.com
  display_name: João Rosa
  first_name: ''
  last_name: ''
permalink: "/2017/08/10/build-a-net-core-2-0-application-in-appveyor/"
---
<p><a href="//www.appveyor.com/">AppVeyor</a> is one of the Continuous Integration Services in the cloud, ready to use, with minimal configuration. It provides a Windows Server image with tooling to build, test and deploy ours .NET applications. Among the baseline software is .NET Core, however, the version is 1.0.4 (at the time of writing this post).</p>
<p>If we are playing around with .NET Core 2.0, AppVeyor doesn't offer the SDK (or the SDK build version that we need). Don't panic, it is possible to download and install other .NET Core SDKs into the instance during our build process. After poking the Internet, the .NET Team offers a <a href="//docs.microsoft.com/en-us/dotnet/core/tools/dotnet-install-script">Powershell and a Bash script</a> to download and install the SDK by version.</p>
<p>Following the documentation, we can install any SDK version using the terminal/command line. The version that my project needs is <code>2.0.0-preview2-006497</code>. Let the games begin!</p>
<p>In a Powershell command line, I craft the command for my version, as:</p>
<pre><code>.\dotnet-install.ps1 -Version 2.0.0-preview2-006497</code></pre>
<p>And Powershell informed me:</p>
<p><img src="{{ site.baseurl }}/assets/ps_dotnetinstall.png" alt="Powershell dotnet_install.ps1 -Version 2.0.0-preview2-006497 command result" /></p>
<p>Hmmm, the required version doesn't exist in the blob. A roadblock... Nothing major. Opening the [source code]<a href="//github.com/dotnet/cli/blob/rel/1.0.0/scripts/obtain/dotnet-install.ps1">script_source_code</a> of the script, we can see that the <a href="//github.com/dotnet/cli/blob/rel/1.0.0/scripts/obtain/dotnet-install.ps1#L396">SDK download link is built</a> based on a few parameters.</p>
<p>The .NET Team already did all the work regarding downloading, unpacking and installing the SDK, and I can leverage the script to get the SDK from another source. The official download link is <a href="//download.microsoft.com/download/F/A/A/FAAE9280-F410-458E-8819-279C5A68EDCF/dotnet-sdk-2.0.0-preview2-006497-win-x64.zip">https://download.microsoft.com/download/F/A/A/FAAE9280-F410-458E-8819-279C5A68EDCF/dotnet-sdk-2.0.0-preview2-006497-win-x64.zip</a>.</p>
<p>Doing a little tweak to <a href="//github.com/joaoasrosa/pullrequests-viewer/blob/master/build/install-dotnet.ps1#L396">the file</a>, it is possible to point the download of the SDK to the official download link:</p>
<pre><code># $DownloadLinks = Get-Download-Links -AzureFeed $AzureFeed -AzureChannel $AzureChannel -SpecificVersion $SpecificVersion -CLIArchitecture $CLIArchitecture
$DownloadLinks = @("https://download.microsoft.com/download/F/A/A/FAAE9280-F410-458E-8819-279C5A68EDCF/dotnet-sdk-2.0.0-preview2-006497-win-x64.zip")</code></pre>
<p>At this point, I have all the individual components to make the final solution. The <code>appveyor.yml</code> file needs to execute the <code>dotnet_install</code> script before building the .NET Core 2 application:</p>
<pre><code>version: 0.0.{build}
image: Visual Studio 2017 Preview
build_script:
- ps: &gt;-
    ./build/install-dotnet.ps1
    dotnet --version
    # Build application
test: off</code></pre>
<p>And AppVeyor reports:</p>
<p><img src="{{ site.baseurl }}/assets/appveyor_build.png" alt="AppVeyor installs the .NET Core 2.0 SDK" /></p>
<p>Hurray, I have .NET Core 2.0 SDK installed, and my application is built successfully! :)</p>
<p>You can use this solution to install <em>any</em> version of the SDK that is not supported by the AppVeyor official image. You can jump to .NET Core 2.1!</p>
